## 04/14

### Django REST framework Tutorial 재진행


#### Router

class based view 에서 URL을 자동으로 정리해 준다.

ViewSet 만 적용된다.

APIView 는 안된다.

## 04/15

#### permission

게시물에 대해 댓글 기능 구현중..

댓글은 작성자만 편집할 수 있고 보기는 누구나 가능해야 한다.

게시물을 출력시 댓글도 같이 불러와야한다..

일단 권한은 아래처럼 permissions.py 으로 custom permission 을 적용해 주면 된다.

권한을 이용해 게시물에도 똑같이 적용할 수 있다. (지금 구현하는건 공공데이터를 통해 자동저장하므로 작성자가 없어서 관리자 외에는 수정권한이 없게 하였다.)

```
# permissions.py

from rest_framework import permissions

class IsOwnerOrReadOnly(permissions.BasePermission):
    def has_object_permission(self, request, view, obj):
        if request.method in permissions.SAFE_METHODS:
            return True
        return obj.owner == request.user
```

```
#views..py

class SnippetViewSet(viewsets.ModelViewSet):
    queryset = PostComment.objects.all()
    serializer_class = SnippetSerializer
    permission_classes = (permissions.IsAuthenticatedOrReadOnly, IsOwnerOrReadOnly,)
    pagination_class = CommentPagination

    def perform_create(self, serializer):
        serializer.save(author=self.request.user)
```

```
# serializers.py

class SnippetSerializer(serializers.HyperlinkedModelSerializer):
    author = serializers.ReadOnlyField(source='author.username')

    class Meta:
        model = PostComment
        fields = '__all__'```

```
#models.py

from django.db import models

class PostComment(models.Model):
    body = models.TextField()
    score = models.CharField(max_length=1, null=True)
    created_date = models.DateTimeField(auto_now_add=True)
    post = models.ForeignKey(Content, on_delete=models.CASCADE)
    author = models.ForeignKey(MyUser, related_name='post_author')

    class Meta:
        ordering = ('created_date',)
```

## 04/16

계획을 변경하여 content view api에서 content의 comment를 바로 출력하기로 함.

serializer를 통하여 구현하려고 한다.


```python
          from rest_framework import serializers

from content_api.models import Content
from content_api.models.content import PostComment

__all__ = (
    'ContentDetailSerializer',
    'ContentSimpleSerializer',
)


# 전체 콘텐츠 출력시 기본정보만 나오는 시리얼라이저
class ContentSimpleSerializer(serializers.ModelSerializer):
    class Meta:
        model = Content
        fields = ('seq', 'title', 'start_date', 'end_date', 'place', 'realm_name',
                  'area', 'price', 'thumbnail',)


# 상세페이지에서 추가 정보 불러오기 위한 필드(작업중)
class CommentListField(serializers.RelatedField):
    def to_representation(self, value):
        return 'review %s' % (value.username,)


# 상세 페이지 출력시 상세정보까지 나오는 시리얼라이저
class ContentDetailSerializer(serializers.ModelSerializer):
    comment = CommentListField(many=True, read_only=True)

    class Meta:
        model = Content
        fields = '__all__' 

# 코멘트 시리얼라이저
class CommentSerializer(serializers.ModelSerializer):
    class Meta:
        model = PostComment
        fields = '__all__'
```

하지만 model의 relation 때문에 막힌다...
시리얼라이저로 content에서 comment를 출력하려하지만 
MyUser의 필드가 없기 때문에 안됨...

comment 모델을 지정하였지만 동작하지 않는다...

[참고문서 REST](https://github.com/KimDoKy/DjangoRestFramework-Tutorial/blob/master/doc/Django%20REST%20Framework%20-%2011.%20Serializer%20relations.md)
